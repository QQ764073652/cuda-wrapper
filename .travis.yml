language: cpp
sudo: enabled
compiler:
- gcc
matrix:
  include:
  - name: CUDA 8
    env:
    - CUDA=8.0.61-1
    - CUDA_SHORT=8.0
    - CUDA_APT=8-0
    - UBUNTU_VERSION=ubuntu1604
    dist: xenial
  - name: CUDA 9
    env:
    - CUDA=9.2.148-1
    - CUDA_SHORT=9.2
    - CUDA_APT=9-2
    - UBUNTU_VERSION=ubuntu1604
    dist: xenial
  - name: CUDA 10
    env:
    - CUDA=10.1.105-1
    - CUDA_APT=10-1
    - CUDA_SHORT=10.1
    - UBUNTU_VERSION=ubuntu1804
    dist: bionic
before_install:
- INSTALLER=cuda-repo-${UBUNTU_VERSION}_${CUDA}_amd64.deb
- wget http://developer.download.nvidia.com/compute/cuda/repos/${UBUNTU_VERSION}/x86_64/${INSTALLER}
- sudo dpkg -i ${INSTALLER}
- wget https://developer.download.nvidia.com/compute/cuda/repos/${UBUNTU_VERSION}/x86_64/7fa2af80.pub
- sudo apt-key add 7fa2af80.pub
- sudo apt update -qq
- sudo apt install -y cuda-core-${CUDA_APT} cuda-cudart-dev-${CUDA_APT} cuda-cufft-dev-${CUDA_APT}
- sudo apt clean
- CUDA_HOME=/usr/local/cuda-${CUDA_SHORT}
- export LD_LIBRARY_PATH=${CUDA_HOME}/targets/x86_64-linux/lib/stubs:${LD_LIBRARY_PATH}
- PATH=${CUDA_HOME}/bin:${PATH}
- sudo ln -s $CUDA_HOME /usr/local/cuda
- sudo cp /usr/local/cuda/targets/x86_64-linux/lib/stubs/libcuda.so /usr/lib/
script:
- "./build.sh"
deploy:
  provider: releases
  api_key:
    secure: Hqat9SPY7uNTGPxtMBPFspJT3fgBTBmgONwdxwOn6A9R/FkHZJ3vy383cl1aRlSYyKeqsuYKP2UGfs8r6VcpEvY08wVUuW2Tdj0tFoz2JBz2+gLu85uXcfPAVRnhawJSW2cGTCkz6IFVs6x09RQVF8SIgBri9TSjNefvQCFST2wbV2DG2/Mq1YKHzopQDdZ47Z43zsgNJAckbwH2gXbUmjl6Ed1fLJ/jGl5YV0/FzHpyUww/CMMrE7Dqx0K5aa//CCU+aL1N0hqi4Q2beQAEMHUbbU3qOpv8aV85ERucSGZwFRst6jzF3IjYJMLSXsfsNPDoT3+tOxr6RG1RGHkiWMVv03xbsTqeEYRN/gOM0NN87LM7K9b11fbCcdE/kztjaSYPV1UaNYZpt1fGgCeWyRtVjUE2LLSkYZsIRNFdqlVvZHOlb780koQ8VTnMUiNFF2BM6WVxINciW580wNvVpm8j3eh3X2LDMgVYISpyf5oUySalVc4DfkpNd87MxaT1KeQB6yl1LoDYIPlZ+pqBtcIXXX2DPOmYdGEmWyxHiNoVq4zDD+5AcAMcnaitexSa4quJg8B2vxsI2e7GZAbdy78jWrZor+n71ybc3Wba0kkEeArReQJ/46WXjBZT4EISjNJggyjeF0PeUVksTs+szIC4/iBO2aU4Gl5MptceEqU=
  file_glob: true
  file: release/*
  on:
    repo: yzs981130/cuda-wrapper
